---
title: "ReplacementAlgorithm"
date: 2020-06-28T21:28:09+08:00
draft: false
categories: ["operation system"]
tags: ["algorithm"]
---
### 引言  
&emsp;&emsp;进程运行时，若其所要访问的页面不在内存，而需把他们调入内存，但内存已无空闲空间时，为了保证该进程能正常运行，系统必须从内存中调出一页程序和数据送到磁盘的对换区中。这种把选择换出页面的算法称为页面置换算法。   
### 例子  
&emsp;&emsp;要求使用最佳置换算法，先进先出算法，最近最久置换算法求解置换次数和缺页中断(使用的是三个物理块)        

|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|  
| 7 | 0 | 1 | 2 | 0 | 3 | 0 | 4 | 2 | 3 | 0 | 3 | 2 | 1 | 2 | 0 | 1 | 7 | 0 | 1 |
### 最佳置换算法(Optimal)  
&emsp;&emsp;这是一种理论上的算法。思想：选择的被淘汰页面是以后永远不使用的，或在很长一段时间内不在被访问的页面。强调未来性。  
优点：保证获得最低的缺页率。   
缺点：由于未来是不可确定的，造成了一个进程在内存的若干个页面中，哪一个页面是未来最长时间不再被访问的，这是不可预知的，但可以通过该算法去评估其他算法。  
解: 

|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|  
| 7 | 7 | 7 | 2 |   | 2 |   | 2 |   |   | 2 |   |   | 2 |   |   |   | 7 |   |   |
|   | 0 | 0 | 0 |   | 0 |   | 4 |   |   | 0 |   |   | 0 |   |   |   | 0 |   |   |
|   |   | 1 | 1 |   | 3 |   | 3 |   |   | 3 |   |   | 1 |   |   |   | 1 |   |   |  

解法:由于有三个物理块，可以放入三个页面。第一个物理块放入7，第二个物理块放入0，第三个物理块放入1，这时物理块中已没有多余的空间放入页面2，所以需要置换出页面。根据最佳置换算法的思想，置换出以后永远不使用的或很长一段时间不使用的页面。通过查找7,0,1在以后使用的情况来比较分析，7在第18次访问时调入内存中，0在第4次访问时时调入内存，而1则在第12次时访问调入内存，所以得到7在很长一段时间不会使用，把7置换出去，把2调入内存。如果所置换的页面在内存中存在则不进行置换。  
结论：使用最佳置换算法，发生可6次置换，9次缺页中断。  
### 先进先出页面置换算法(FIFO)  
&emsp;&emsp;先进先出置换算法是一种总是淘汰最先进入内存的页面，即选择最久在内存驻留的页面淘汰。 
适用范围：顺序结构   
优点：实现简单，不需要硬件的支持，不需要增加系统的成本。  
缺点：没有考虑到缓存页面被使用的情况。如果一个页面被频繁的使用，应该把它放在缓存中，来提高系统的性能，而先进先出页面置换算法可能把频繁使用的页面清除出缓存。    

解：

|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|  
| 7 | 7 | 7 | 2 |   | 2 | 2 | 4 | 4 | 4 | 0 |   |   | 0 | 0 |   |   | 7 | 7 | 7 |
|   | 0 | 0 | 0 |   | 3 | 3 | 3 | 2 | 2 | 2 |   |   | 1 | 1 |   |   | 1 | 0 | 0 |
|   |   | 1 | 1 |   | 1 | 0 | 0 | 0 | 3 | 3 |   |   | 3 | 2 |   |   | 2 | 2 | 1 |  

解决:置换页面时确定当前页面是否是驻留内存最久的页面，如果是驻留最久的页面，把要置换的页面给放到当前的内存  
结论:使用先进先出置换算法，发生12次置换，15次缺页中断。  

### 最近最久未使用(LRU)和最少使用置换算法(LFU)   
* LRU  
&emsp;&emsp;最近最久页面置换算法，即把最近最久未使用的页面给置换出内存。  

|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|  
| 7 | 0 | 1 | 2 |   | 3 |   | 4 | 2 | 3 | 0 |   |   | 1 |   | 0 |   | 7 |   |   |
|   | 7 | 0 | 1 |   | 0 |   | 0 | 4 | 2 | 3 |   |   | 2 |   | 2 |   | 1 |   |   |
|   |   | 7 | 0 |   | 2 |   | 3 | 0 | 4 | 2 |   |   | 3 |   | 1 |   | 0 |   |   |  

解法：先把7,0,1放入内存，现在要把页面2放入内存，但现在内存中没有空间来执行页面2，所以根据最近最久页面置换算法的原则，把最近最久未使用的页面7置换出内存，把页面2置换到内存。如果所置换的页面在内存中已存在，做不需要进行置换，可以把它放到内存的第一个(如线程的优先级，因为它要执行，所有优先级高)，方便观察。  
结论：通过最近最久页面置换算法，发生9次页面置换，12次缺页中断。  

* LFU  
&emsp;&emsp;该算法选择最近时期使用次数最少的页面作为淘汰。它为每个页保留一个用于记录页被访问次数的计数器，每次选择其访问计数器值最小的页换出。 

### Clock置换算法  
* 简单CLOCK置换算法  
&emsp;&emsp;通过给每一个访问的页面关联一个**附加位(使用位|访问位)**。  
思想：简单CLOCK算法是在内存中设置一位访问位，在将内存中的所有页面都通过链接指针链接成一个循环队列。当某一页装入内存时，将访问位置为1；如果该页之后又被访问到，访问位还是标记为1。如果内存中没有空间来存放所置换的页面，这时先把所有的访问位置为0，然后把置换的页面置换到指针所指向的内存位置，再把访问位置为1，指针向前移动一位；如果所置换的页面在内存中存在，则访问位从0置换1。  

* 改进CLOCK置换算法  
&emsp;&emsp;改进的CLOCK算法在原有的访问位的基础上，增加了一个修改位。这样就形成了访问位和修改为的组合类型，即：  
(0,0),最近未被访问，未被修改，表示最佳淘汰页；  
(0,1),最近未被访问，但已被修改，并不是很好的淘汰页；  
(1,0),最近已被访问，但未被修改，表示该页可能再被访问；  
(1,1),最近已被访问且已被修改，表示该页可能再被访问。  

### REFERENCES  
[1] 汤晓丹.梁红兵,等.计算机操作系统.西安电子科技大学出版社.2014.5  
[2] https://alleniverson.gitbooks.io/operating_system/chapter03/7.%20页面置换算法.html  
[3] https://baike.baidu.com/item/先进先出页面置换算法/3286551   
[4] https://github.com/totororz/Examples-of-page-replacement-problems/blob/master/page-rep3.pdf    
[5] https://blog.csdn.net/zhuixun_/article/details/85336417  
